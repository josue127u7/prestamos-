<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Importe de Pago ‚Äî Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#ffffff; --bg2:#eaf9f0; --accent:#28a745; --accent-dark:#1f7a34;
      --muted:#6b7280; --card-shadow:0 10px 28px rgba(17,24,39,0.12);
    }
    html,body{height:100%;margin:0;font-family:"Poppins",sans-serif;background:linear-gradient(180deg,var(--bg1) 0%,var(--bg2)100%);overflow:hidden}
    .page{position:relative;z-index:5;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px;box-sizing:border-box}
    .card{width:94%;max-width:620px;max-height:85vh;overflow-y:auto;background:#fff;border-radius:18px;box-shadow:var(--card-shadow);padding:28px;text-align:center;position:relative;z-index:10;transition:transform .28s ease}
    h1{margin:0 0 10px;font-size:22px;color:#15303a;cursor:pointer;font-weight:600}
    .alerta{display:inline-block;padding:8px 12px;border-radius:10px;background:var(--accent);color:#fff;margin:10px 0 16px;font-weight:600;font-size:13px}
    h2.principal{margin:12px 0;font-size:38px;color:var(--accent-dark);font-weight:700}
    .info-row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
    .info-item{text-align:left;min-width:150px}
    .info-item strong{display:block;color:#15303a;font-weight:600}
    .info-item span{color:var(--muted)}
    .btn{display:block;width:100%;padding:12px 14px;margin:8px 0;border-radius:12px;border:0;font-weight:700;color:#fff;cursor:pointer;box-shadow:0 6px 18px rgba(16,24,40,0.06);transition:transform .12s ease,opacity .12s}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--accent-dark)}
    .btn-secondary{background:#1861b2}
    .btn-warning{background:#ff9f1c;color:#111}
    #adminLogin,#adminPanel{text-align:left;margin-top:14px}
    input,textarea,select{width:100%;padding:10px 12px;margin:6px 0;border-radius:9px;border:1px solid #dbe6db;font-size:14px;box-sizing:border-box}
    textarea{min-height:80px;resize:vertical}
    .admin-section{margin:10px 0 18px;padding:10px;border-radius:10px;background:#fbfdfb;border:1px solid #eef8ee}
    .cuenta-box{display:flex;align-items:center;justify-content:space-between;background:#f7fff7;border:1px solid #e2f3e4;padding:10px;border-radius:10px;margin:8px 0}
    .cuenta-text{font-weight:600;color:#173d27;word-break:break-all}
    .copy-btn{background:var(--accent-dark);color:#fff;border:0;padding:8px 10px;border-radius:8px;cursor:pointer}
    #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#0f1724;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .2s;z-index:60}
    .logo-superior{position:fixed;top:12px;left:16px;width:140px;height:auto;z-index:200;pointer-events:none}
    /* share buttons style */
    #shareWhatsApp,#shareTelegram{display:inline-block;padding:10px 16px;border-radius:10px;border:0;color:#fff;font-weight:700;cursor:pointer;margin:6px}
    #shareWhatsApp{background:linear-gradient(135deg,#25D366,#128C7E)}
    #shareTelegram{background:linear-gradient(135deg,#37AEE2,#0088CC)}
  </style>
</head>
<body>
  <img src="https://josue127u7.github.io/imagen-pay/cropped-payment.png" alt="Payment Latam Logo" class="logo-superior">

  <div class="page">
    <div class="card" role="main" aria-labelledby="titulo">
      <h1 id="titulo" tabindex="0">Importe de Pago</h1>
      <div class="alerta">‚ö†Ô∏è Paga solo mediante el link oficial</div>

      <h2 class="principal" id="importe">$0.00</h2>

      <div class="info-row" aria-hidden="false">
        <div class="info-item"><strong>Producto</strong><span id="proveedor">---</span></div>
        <div class="info-item"><strong>Monto pr√©stamo</strong><span id="monto">$0.00</span></div>
        <div class="info-item"><strong>Fecha de pago</strong><span id="fecha">---</span></div>
      </div>

      <button id="btnPagar" class="btn btn-primary">Pagar todo</button>
      <button id="btnExtender" class="btn btn-secondary">Extender pago</button>
      <button id="btnPasos" class="btn btn-warning">Pasos a seguir</button>

      <div id="adminLogin" aria-hidden="true" style="display:none;margin-top:12px;">
        <input id="password" type="password" placeholder="Contrase√±a admin" aria-label="Contrase√±a admin">
        <button id="btnEntrar" class="btn btn-secondary" style="margin-top:8px;">Entrar</button>
      </div>

      <div id="adminPanel" style="display:none;">
        <div class="admin-section">
          <h4>Editar datos generales</h4>
          <input id="proveedorInput" placeholder="Proveedor">
          <input id="montoInput" type="number" step="0.01" placeholder="Monto pr√©stamo">
          <input id="importeInput" type="number" step="0.01" placeholder="Importe de pago">
          <input id="fechaInput" type="date" placeholder="Fecha pr√≥xima pago">
        </div>

        <div class="admin-section">
          <h4>Datos ‚Äî Pagar todo</h4>
          <input id="pagarMonto" type="number" step="0.01" placeholder="Monto">
          <input id="pagarDescripcion" placeholder="Descripci√≥n">
          <input id="pagarFecha" type="datetime-local">
          <input id="pagarUsuario" placeholder="Usuario">
          <input id="pagarCuenta" placeholder="Cuenta">
          <input id="pagarCuentaInter" placeholder="Cuenta interbancaria">
          <input id="pagarBanco" placeholder="Banco">
        </div>

        <div class="admin-section">
          <h4>Datos ‚Äî Extender pago</h4>
          <input id="extMonto" type="number" step="0.01" placeholder="Monto">
          <input id="extDescripcion" placeholder="Descripci√≥n">
          <input id="extFecha" type="datetime-local">
          <input id="extUsuario" placeholder="Usuario">
          <input id="extCuenta" placeholder="Cuenta">
          <input id="extCuentaInter" placeholder="Cuenta interbancaria">
          <input id="extBanco" placeholder="Banco">
        </div>

        <div class="admin-section">
          <h4>Pasos (cada l√≠nea ‚Üí un paso)</h4>
          <textarea id="pasosInput" placeholder="Paso 1&#10;Paso 2"></textarea>
          <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="guardarDatos()">üíæ Guardar cambios</button>
            <button class="btn btn-secondary" onclick="restartSession()">üîÑ Reactivar p√°gina</button>
            <button class="btn btn-warning" onclick="logout()">üö™ Cerrar sesi√≥n</button>

            <!-- BOTONES DE COMPARTIR (solo estos) -->
            <button id="shareWhatsApp">Enviar por WhatsApp</button>
            <button id="shareTelegram">Enviar por Telegram</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Modales (sin cambios importantes) -->
  <div id="modalPagar" class="modal" role="dialog" aria-modal="true" aria-hidden="true" style="display:none;">
    <div class="modal-card">
      <button class="modal-close" aria-label="Cerrar">‚úï</button>
      <h3>Pagar todo</h3>
      <p><span class="info-label">Monto:</span> <span id="pagarMontoTxt">$0.00</span></p>
      <p><span class="info-label">Descripci√≥n:</span> <span id="pagarDescripcionTxt">---</span></p>
      <p><span class="info-label">Fecha:</span> <span id="pagarFechaTxt">---</span></p>
      <p><span class="info-label">Usuario:</span> <span id="pagarUsuarioTxt">---</span></p>
      <div class="cuenta-box">
        <div style="flex:1"><div style="font-size:12px;color:#3b5541;font-weight:600">Cuenta</div><div class="cuenta-text" id="pagarCuentaTxt">---</div></div>
        <button class="copy-btn" onclick="copiarTexto('pagarCuentaTxt')">Copiar</button>
      </div>
      <div class="cuenta-box">
        <div style="flex:1"><div style="font-size:12px;color:#3b5541;font-weight:600">Interbancaria</div><div class="cuenta-text" id="pagarCuentaInterTxt">---</div></div>
        <button class="copy-btn" onclick="copiarTexto('pagarCuentaInterTxt')">Copiar</button>
      </div>
      <p><span class="info-label">Banco:</span> <span id="pagarBancoTxt">---</span></p>
    </div>
  </div>

  <div id="modalExtender" class="modal" role="dialog" aria-modal="true" aria-hidden="true" style="display:none;">
    <div class="modal-card">
      <button class="modal-close" aria-label="Cerrar">‚úï</button>
      <h3>Extender pago</h3>
      <p><span class="info-label">Monto:</span> <span id="extMontoTxt">$0.00</span></p>
      <p><span class="info-label">Descripci√≥n:</span> <span id="extDescripcionTxt">---</span></p>
      <p><span class="info-label">Fecha:</span> <span id="extFechaTxt">---</span></p>
      <p><span class="info-label">Usuario:</span> <span id="extUsuarioTxt">---</span></p>
      <div class="cuenta-box"><div style="flex:1"><div style="font-size:12px;color:#1b3e5a;font-weight:600">Cuenta</div><div class="cuenta-text" id="extCuentaTxt">---</div></div><button class="copy-btn" onclick="copiarTexto('extCuentaTxt')">Copiar</button></div>
      <div class="cuenta-box"><div style="flex:1"><div style="font-size:12px;color:#1b3e5a;font-weight:600">Interbancaria</div><div class="cuenta-text" id="extCuentaInterTxt">---</div></div><button class="copy-btn" onclick="copiarTexto('extCuentaInterTxt')">Copiar</button></div>
      <p><span class="info-label">Banco:</span> <span id="extBancoTxt">---</span></p>
    </div>
  </div>

  <div id="modalPasos" class="modal" role="dialog" aria-modal="true" aria-hidden="true" style="display:none;">
    <div class="modal-card">
      <button class="modal-close" aria-label="Cerrar">‚úï</button>
      <h3>Pasos a seguir</h3>
      <ol id="listaPasos" style="padding-left:18px;margin-top:8px;color:#213434"></ol>
    </div>
  </div>

  <div id="toast" aria-hidden="true"></div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const LS_KEY = 'prestamoData_v1';
    const PASSWORD = '1234';

    // Pon aqu√≠ tu enlace p√∫blico (si cambias Netlify o dominio, actualiza la URL)
    const PUBLIC_LINK = 'https://prestamos-app.netlify.app/';

    function formatCurrency(v){
      const n = Number(v);
      if (!isFinite(n)) return '$0.00';
      return '$' + n.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
    }
    function parseNumber(s){
      if(s == null) return 0;
      if(typeof s === 'number') return s;
      const cleaned = String(s).replace(/[^0-9.-]+/g,'');
      const n = parseFloat(cleaned);
      return isNaN(n) ? 0 : n;
    }
    function showToast(msg, ms=1500){
      const t = document.getElementById('toast'); if(!t) return;
      t.textContent = msg; t.style.opacity = '1'; t.setAttribute('aria-hidden','false');
      clearTimeout(t._timer); t._timer = setTimeout(()=>{ t.style.opacity='0'; t.setAttribute('aria-hidden','true'); }, ms);
    }

    function getDefaultData(){
      return {
        proveedor:'', monto:0, importe:0, fecha:'', pasos:[],
        pagar:{monto:'',descripcion:'',fecha:'',usuario:'',cuenta:'',cuentaInter:'',banco:''},
        extender:{monto:'',descripcion:'',fecha:'',usuario:'',cuenta:'',cuentaInter:'',banco:''}
      };
    }

    function setText(id, txt){ const el = document.getElementById(id); if(el) el.textContent = txt; }
    function setInput(id, val){ const el = document.getElementById(id); if(el) el.value = val == null ? '' : val; }

    function loadData(){
      const raw = localStorage.getItem(LS_KEY);
      const data = raw ? JSON.parse(raw) : getDefaultData();
      data.pagar = data.pagar || getDefaultData().pagar; data.extender = data.extender || getDefaultData().extender;
      setText('proveedor', data.proveedor || '---');
      setText('monto', data.monto ? formatCurrency(data.monto) : '$0.00');
      setText('importe', data.importe ? formatCurrency(data.importe) : '$0.00');
      setText('fecha', data.fecha || '---');

      setInput('proveedorInput', data.proveedor || '');
      setInput('montoInput', data.monto || '');
      setInput('importeInput', data.importe || '');
      setInput('fechaInput', data.fecha || '');
      setInput('pagarMonto', data.pagar.monto || '');
      setInput('pagarDescripcion', data.pagar.descripcion || '');
      setInput('pagarFecha', data.pagar.fecha || '');
      setInput('pagarUsuario', data.pagar.usuario || '');
      setInput('pagarCuenta', data.pagar.cuenta || '');
      setInput('pagarCuentaInter', data.pagar.cuentaInter || '');
      setInput('pagarBanco', data.pagar.banco || '');
      setInput('extMonto', data.extender.monto || '');
      setInput('extDescripcion', data.extender.descripcion || '');
      setInput('extFecha', data.extender.fecha || '');
      setInput('extUsuario', data.extender.usuario || '');
      setInput('extCuenta', data.extender.cuenta || '');
      setInput('extCuentaInter', data.extender.cuentaInter || '');
      setInput('extBanco', data.extender.banco || '');
      setInput('pasosInput', Array.isArray(data.pasos) ? data.pasos.join('\n') : '');
    }

    window.guardarDatos = function(){
      const data = {
        proveedor: (document.getElementById('proveedorInput')?.value || '').trim(),
        monto: parseNumber(document.getElementById('montoInput')?.value || 0),
        importe: parseNumber(document.getElementById('importeInput')?.value || 0),
        fecha: document.getElementById('fechaInput')?.value || '',
        pasos: (document.getElementById('pasosInput')?.value || '').split('\n').map(s=>s.trim()).filter(Boolean),
        pagar: {
          monto: document.getElementById('pagarMonto')?.value || '',
          descripcion: document.getElementById('pagarDescripcion')?.value || '',
          fecha: document.getElementById('pagarFecha')?.value || '',
          usuario: document.getElementById('pagarUsuario')?.value || '',
          cuenta: document.getElementById('pagarCuenta')?.value || '',
          cuentaInter: document.getElementById('pagarCuentaInter')?.value || '',
          banco: document.getElementById('pagarBanco')?.value || ''
        },
        extender: {
          monto: document.getElementById('extMonto')?.value || '',
          descripcion: document.getElementById('extDescripcion')?.value || '',
          fecha: document.getElementById('extFecha')?.value || '',
          usuario: document.getElementById('extUsuario')?.value || '',
          cuenta: document.getElementById('extCuenta')?.value || '',
          cuentaInter: document.getElementById('extCuentaInter')?.value || '',
          banco: document.getElementById('extBanco')?.value || ''
        }
      };
      localStorage.setItem(LS_KEY, JSON.stringify(data));
      loadData();
      showToast('Datos guardados ‚úÖ',1200);
    };

    window.restartSession = function(){ localStorage.removeItem(LS_KEY); location.reload(); };

    // UI actions (botones)
    const safeOn = (id, fn) => { const el = document.getElementById(id); if(el) el.addEventListener('click', fn); };

    safeOn('btnPagar', ()=> {
      const d = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
      setText('pagarMontoTxt', d.pagar?.monto ? formatCurrency(d.pagar.monto) : '$0.00');
      setText('pagarDescripcionTxt', d.pagar?.descripcion || '---');
      setText('pagarFechaTxt', d.pagar?.fecha ? new Date(d.pagar.fecha).toLocaleString() : '---');
      setText('pagarUsuarioTxt', d.pagar?.usuario || '---');
      setText('pagarCuentaTxt', d.pagar?.cuenta || '---');
      setText('pagarCuentaInterTxt', d.pagar?.cuentaInter || '---');
      setText('pagarBancoTxt', d.pagar?.banco || '---');
      const modal = document.getElementById('modalPagar'); if(modal){ modal.style.display='flex'; modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); }
    });

    safeOn('btnExtender', ()=> {
      const d = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
      setText('extMontoTxt', d.extender?.monto ? formatCurrency(d.extender.monto) : '$0.00');
      setText('extDescripcionTxt', d.extender?.descripcion || '---');
      setText('extFechaTxt', d.extender?.fecha ? new Date(d.extender.fecha).toLocaleString() : '---');
      setText('extUsuarioTxt', d.extender?.usuario || '---');
      setText('extCuentaTxt', d.extender?.cuenta || '---');
      setText('extCuentaInterTxt', d.extender?.cuentaInter || '---');
      setText('extBancoTxt', d.extender?.banco || '---');
      const modal = document.getElementById('modalExtender'); if(modal){ modal.style.display='flex'; modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); }
    });

    safeOn('btnPasos', ()=> {
      const d = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
      const ol = document.getElementById('listaPasos'); if(!ol) return;
      ol.innerHTML = ''; (d.pasos || []).forEach(p => { const li = document.createElement('li'); li.textContent = p; ol.appendChild(li); });
      const modal = document.getElementById('modalPasos'); if(modal){ modal.style.display='flex'; modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); }
    });

    // cerrar modales
    document.querySelectorAll('.modal-close').forEach(b => b.addEventListener('click', (e)=>{ const m = e.target.closest('.modal'); if(m){ m.classList.remove('open'); m.style.display='none'; m.setAttribute('aria-hidden','true'); }}));
    document.querySelectorAll('.modal').forEach(m => m.addEventListener('click', (ev)=>{ if(ev.target === m){ m.classList.remove('open'); m.style.display='none'; m.setAttribute('aria-hidden','true'); }}));

    window.copiarTexto = function(id){ const el = document.getElementById(id); if(!el) return; const txt = el.textContent || el.value || ''; navigator.clipboard.writeText(txt).then(()=>showToast('Copiado: '+txt,1400)).catch(()=>alert('No se pudo copiar')); };

    // admin login
    window.login = function(){ const pass = document.getElementById('password')?.value || ''; if(pass===PASSWORD){ document.getElementById('adminPanel').style.display='block'; document.getElementById('adminLogin').style.display='none'; setTimeout(()=>document.getElementById('proveedorInput')?.focus(),120); loadData(); } else alert('Contrase√±a incorrecta ‚ùå'); };
    window.logout = function(){ document.getElementById('adminPanel').style.display='none'; document.getElementById('adminLogin').style.display='none'; };

    document.getElementById('btnEntrar')?.addEventListener('click', ()=> login());
    document.getElementById('password')?.addEventListener('keydown', (e)=>{ if(e.key==='Enter') login(); });

    // SHARE / BUILD URL (usando PUBLIC_LINK para evitar file:///)
    function buildShareUrl(data){
      const url = new URL(PUBLIC_LINK);
      if(data.proveedor) url.searchParams.set('proveedor', data.proveedor);
      if(data.importe !== undefined) url.searchParams.set('importe', String(data.importe));
      if(data.monto !== undefined) url.searchParams.set('monto', String(data.monto));
      if(data.fecha) url.searchParams.set('fecha', data.fecha);
      if(data.pagar?.cuenta) url.searchParams.set('pagarCuenta', data.pagar.cuenta);
      if(data.pagar?.cuentaInter) url.searchParams.set('pagarCuentaInter', data.pagar.cuentaInter);
      if(data.pagar?.banco) url.searchParams.set('pagarBanco', data.pagar.banco);
      return url.toString();
    }
    function buildMessageText(data){
      const proveedor = data.proveedor || '---';
      const importe = data.importe ? formatCurrency(data.importe) : '$0.00';
      const fecha = data.fecha || '---';
      const url = buildShareUrl(data);
      return `üìå *Pago pendiente*\n\nüè¶ Producto: ${proveedor}\nüíµ Importe: ${importe}\nüìÖ Fecha: ${fecha}\n\nüëâ Paga aqu√≠: ${url}`;
    }

    safeOn('shareWhatsApp', ()=>{
      guardarDatos();
      const data = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
      const text = encodeURIComponent(buildMessageText(data));
      window.open(`https://api.whatsapp.com/send?text=${text}`, '_blank');
    });

    safeOn('shareTelegram', ()=>{
      guardarDatos();
      const data = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
      const text = encodeURIComponent(buildMessageText(data));
      window.open(`https://t.me/share/url?url=${encodeURIComponent(PUBLIC_LINK)}&text=${text}`, '_blank');
    });

    // Enviar WhatsApp desde script (si quieres usar otra funci√≥n)
    window.enviarWhatsApp = function(){
      const data = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
      const mensaje = `Hola, aqu√≠ est√° tu link personalizado: ${buildShareUrl(data)}`;
      window.open('https://wa.me/?text=' + encodeURIComponent(mensaje), '_blank');
    };

    // Aplicar par√°metros de la URL al cargar (si alguien abre el link con ?proveedor=...)
    (function applyUrlParams(){
      try{
        const params = new URLSearchParams(window.location.search);
        if(!params || Array.from(params.keys()).length === 0){ loadData(); return; }
        const existing = JSON.parse(localStorage.getItem(LS_KEY) || '{}');
        const merged = Object.assign({}, existing);
        if(params.has('proveedor')) merged.proveedor = params.get('proveedor');
        if(params.has('importe')) merged.importe = parseNumber(params.get('importe'));
        if(params.has('monto')) merged.monto = parseNumber(params.get('monto'));
        if(params.has('fecha')) merged.fecha = params.get('fecha');
        if(params.has('pagarCuenta')) { merged.pagar = merged.pagar || {}; merged.pagar.cuenta = params.get('pagarCuenta'); }
        if(params.has('pagarCuentaInter')) { merged.pagar = merged.pagar || {}; merged.pagar.cuentaInter = params.get('pagarCuentaInter'); }
        if(params.has('pagarBanco')) { merged.pagar = merged.pagar || {}; merged.pagar.banco = params.get('pagarBanco'); }
        localStorage.setItem(LS_KEY, JSON.stringify(merged));
        loadData();
      }catch(e){
        console.error('applyUrlParams error', e);
        loadData();
      }
    })();

    // Si quieres forzar limpieza local durante pruebas: usar restartSession()
  });
  </script>
</body>
</html>
